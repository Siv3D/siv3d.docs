# 4. Main 関数とメインループ
Main 関数の構造とメインループについて学びます。

## 4.1 Main 関数の 3 つのパート
- `Main` 関数は 3 つのパートに分けられます

| パート | 説明 | やること |
|--|--|--|
| メインループの前 | プログラムが起動して、最初に実行される部分 | 画面の設定やテクスチャの作成 |
| メインループの中 | 毎秒数十回以上繰り返されるループの中の部分 | 入力処理や描画 |
| メインループの後 | プログラムが終了するときに実行される部分 | （必要に応じて）ゲームのセーブなど |

=== "メインループの前"
	```cpp hl_lines="5-6"
	# include <Siv3D.hpp>

	void Main()
	{


		while (System::Update())
		{

		}
	}
	```

=== "メインループの中"
	```cpp hl_lines="7-9"
	# include <Siv3D.hpp>

	void Main()
	{
		while (System::Update())
		{



		}
	}
	```

=== "メインループの後"
	```cpp hl_lines="9-10"
	# include <Siv3D.hpp>

	void Main()
	{
		while (System::Update())
		{

		}


	}
	```

- 実際のプログラムでは「メインループの中」に大半のコードを書きます
- 「メインループの後」に何かを書くことは少ないです

## 4.2 メインループの周期
- **メインループ**は、プログラムを実行しているモニタ 🖥️ の表示周期（リフレッシュレート）に合わせて繰り返されます。一般に毎秒 60 回や 120 回です
- 通常の C++ プログラムで `for(;;)` のようなループを書くと、性能が許す限り 1 秒間に数万回以上ループしてしまいますが、`while (System::Update())` は違います
- `System::Update()` 関数が内部で**モニタの表示タイミングに合わせた待機**を行い、モニタの表示タイミングに合わせた頻度のループ（1 秒間に数十回～）になるよう制御してくれます
- 次のプログラムを実行すると、1 秒間に何回メインループが繰り返されているかを、画面に表示して確認できます

```cpp
# include <Siv3D.hpp>

void Main()
{
	while (System::Update())
	{
		ClearPrint();
		Print << Profiler::FPS();
	}
}
```


## 4.3 メインループの前にやること
- プログラムで画像を表示したいとき、「画像を読み込む仕事」は**メインループの前**に書くのが一般的です
- メインループの前で画像を 1 度読み込み、あとはそれをメインループの中で描画するようにすれば、最も少ない仕事量で目的を達成できます
- もしメインループの中に「画像を読み込む仕事」を書いてしまうと、1 秒間に数十回も画像の読み込みの仕事が発生し、プログラムの動作が重くなります
- 万が一、メインループの中に「画像を読み込む仕事」を誤って書いて、動作が重くなってしまっても安心です。Siv3D は自動的に問題を検出し、メッセージボックスを表示してプログラムを終了してくれます

=== "メインループの中"
	!!! failure "動作が重くなる"
		- メインループの中で、毎ループ画像を読み込んでテクスチャを作成しています（不適切）
		- 作成されたテクスチャを描画したあと、ループの終端でテクスチャが破棄されるため、作成しては破棄、作成しては破棄という無駄な処理が繰り返されます
		- Siv3D はこのような問題を検知すると、警告のメッセージを出力して自動的にメインループを終了します

		```cpp hl_lines="7-8"
		# include <Siv3D.hpp>

		void Main()
		{
			while (System::Update())
			{
				// 画像ファイルから画像データを読み込んでテクスチャを作成する
				const Texture texture{ U"example/windmill.png" };

				// テクスチャを描画する
				texture.draw();
			}
		}
		```

=== "メインループの前"
	!!! success "OK"
		- メインループの前で、1 度だけ画像を読み込んでテクスチャを作成します
		- そのあとは、作成したテクスチャをメインループの中で描画するだけです

		```cpp hl_lines="5-6"
		# include <Siv3D.hpp>

		void Main()
		{
			// 画像ファイルから画像データを読み込んでテクスチャを作成する
			const Texture texture{ U"example/windmill.png" };

			while (System::Update())
			{
				// テクスチャを描画する
				texture.draw();
			}
		}
		```


## 4.4 メインループの中でやること




